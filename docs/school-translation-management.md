# 学校翻译管理知识点 (School Translation Management)

本文档详细介绍了学校翻译管理模块的技术实现模式，重点关注搜索优化、数据处理和 UI 交互。

## 1. 搜索优化模式

### 1.1 手动防抖 (Manual Debouncing)
在搜索场景中，每次按键都触发 API 请求或繁重的计算是极其低效的。我们利用 `useRef` 实现了一个手动防抖模式。

**概念**：
- **问题**：用户输入 "University" -> 会触发 10 次重新渲染/请求。
- **解决方案**：在执行逻辑之前等待输入暂停（例如 300毫秒）。
- **为什么用 useRef?**：我们需要跨渲染存储 `setTimeout` 的 ID，且在 ID 变化时不触发*新的*重新渲染。

```typescript
const searchTimerRef = useRef<NodeJS.Timeout | null>(null);

const handleNameSearch = (text: string) => {
  // 清除任何待执行的任务
  if (searchTimerRef.current) clearTimeout(searchTimerRef.current);
  
  // 计划新的执行
  searchTimerRef.current = setTimeout(() => {
    // 此处执行昂贵的操作
    updateOptions(text);
  }, 300);
};
```

### 1.2 客户端自动完成过滤
对于“学校名称”自动完成，我们一次性获取翻译数据的*全集*，然后在客户端进行过滤。

**为什么采用这种方法？**
- **低延迟**：与网络往返相比，在内存中过滤 1000-2000 个条目是瞬间完成的。
- **更好的 UX**：下拉菜单会随着用户的输入立即更新。

**Memoization（记忆化）**：
过滤函数使用了 `useCallback`，以确保它不会在每次渲染时重新创建，这在做为依赖项传递给其他 Hook 时至关重要。

## 2. 前端数据管理

### 2.1 区域感知的数据过滤 (Locale-Aware Filtering)
应用程序处理多语言数据（英文/中文）。前端实现了基于当前上下文智能过滤建议的逻辑。
- **上下文**：如果 `locale` 是 'zh'（中文），自动完成仅匹配 `name_zh`。
- **回退**：如果未选择语言，它会同时搜索 `name_en` 和 `name_zh`，以最大程度地提高可查找性。

### 2.2 乐观 UI 更新 vs. 刷新
当切换学校的“可见”状态时：
- **策略**：代码等待 API 成功响应，然后触发数据刷新 (`setParams`)。
- **替代方案（乐观 UI）**：更高级的模式是立即更新本地状态以获得即时反馈，如果 API 失败则回滚。目前的实现优先考虑数据一致性（服务器作为单一事实来源），而非即时的本地反馈。

## 3. Ant Design 组件模式

### 3.1 表格状态同步
表格的分页和请求参数保持严格同步。
- **单一事实来源**：`params` 状态对象控制视图。
- **事件处理**：`handleTableChange` 不仅仅是“翻页”，它更新 `params`，进而触发 `useRequest` Hook 获取新数据。

### 3.2 自定义列渲染
通过自定义渲染器，`antd` Table 列的功能得到了极大增强。
- **Switch 组件**：代替显示枯燥的 "0" 或 "1" 来表示可见性，我们在列中直接渲染一个交互式的 `<Switch />` 组件。
- **行内编辑**：这允许用户在不打开单独“编辑”弹窗的情况下更改状态，显著加快了管理流程。

### 3.3 动态表单输入
搜索表单使用了一个动态的 `AutoComplete` 组件，其选项基于以下内容变化：
1. 用户输入（经过防抖处理）
2. 另一个表单字段的值（语言选择器）

这种依赖关系（表单字段 A 依赖于表单字段 B）是通过在搜索处理程序内部读取表单状态 (`form.getFieldValue('locale')`) 来管理的。
